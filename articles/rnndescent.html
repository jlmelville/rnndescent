<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rnndescent">
<title>rnndescent • rnndescent</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rnndescent">
<meta property="og:description" content="rnndescent">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rnndescent</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.16</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/rnndescent.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/brute-force.html">Brute Force Search</a>
    <a class="dropdown-item" href="../articles/nearest-neighbor-descent.html">Nearest Neighbor Descent</a>
    <a class="dropdown-item" href="../articles/random-partition-forests.html">Random Partition Forests</a>
    <a class="dropdown-item" href="../articles/querying-data.html">Querying Data</a>
    <a class="dropdown-item" href="../articles/hubness.html">Hubness</a>
    <a class="dropdown-item" href="../articles/metrics.html">Metrics</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>rnndescent</h1>
            
      
      
      <div class="d-none name"><code>rnndescent.Rmd</code></div>
    </div>

    
    
<p><code>rnndescent</code> is an R package for finding approximate
nearest neighbors, based heavily on the Python package <a href="https://github.com/lmcinnes/pynndescent" class="external-link">PyNNDescent</a> by <a href="https://github.com/lmcinnes" class="external-link">Leland McInnes</a>, but is a fully
independent reimplementation written in C++. It uses the following
techniques:</p>
<ol style="list-style-type: decimal">
<li>Initialization by creating a forest of random project trees <span class="citation">(Dasgupta and Freund 2008)</span>.</li>
<li>Optimization by using nearest neighbor descent <span class="citation">(Dong, Moses, and Li 2011)</span>.</li>
<li>For querying new data, graph diversification techniques from Fanng
<span class="citation">(Harwood and Drummond 2016)</span>.</li>
</ol>
<p>The easiest way to find k-nearest neighbors and query new data is to
use the <code>rnnd_build</code> and <code>rnnd_query</code> functions,
which combine several of the available techniques into sensible
defaults. For greater flexibility, the underlying functions used by
<code>rnnd_build</code> and <code>rnnd_query</code> can be used
directly. The other vignettes in this package describe their use and go
into more detail about the how the methods work.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jlmelville.github.io/rnndescent/">rnndescent</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="find-the-k-nearest-neighbors">Find the k-nearest neighbors<a class="anchor" aria-label="anchor" href="#find-the-k-nearest-neighbors"></a>
</h2>
<p>If you just want the k-nearest neighbors of some <code>data</code>,
use <code>rnnd_knn</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_knn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnnd_knn.html">rnnd_knn</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="the-neighbor-graph-format">The Neighbor Graph Format<a class="anchor" aria-label="anchor" href="#the-neighbor-graph-format"></a>
</h3>
<p>The nearest neighbor graph format returned by all functions in this
package is a list of two matrices:</p>
<ul>
<li>
<code>idx</code> – a matrix of indices of the nearest neighbors. As
usual in R, these are 1-indexed.</li>
<li>
<code>dist</code> – the equivalent distances.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">iris_knn</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; $idx</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    1   18    5   29   40</span></span>
<span><span class="co">#&gt; [2,]    2   13   46   35   10</span></span>
<span><span class="co">#&gt; [3,]    3   48    4    7   13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dist</span></span>
<span><span class="co">#&gt;      [,1]      [,2]      [,3]      [,4]      [,5]</span></span>
<span><span class="co">#&gt; [1,]    0 0.1000000 0.1414212 0.1414212 0.1414213</span></span>
<span><span class="co">#&gt; [2,]    0 0.1414213 0.1414213 0.1414213 0.1732050</span></span>
<span><span class="co">#&gt; [3,]    0 0.1414213 0.2449490 0.2645751 0.2645753</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="build-an-index">Build an Index<a class="anchor" aria-label="anchor" href="#build-an-index"></a>
</h2>
<p><code>rnnd_knn</code> returns the k-nearest neighbors, but does not
return any “index” that you can use to query new data. To do that, use
<code>rnnd_build</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnnd_build.html">rnnd_build</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>The index is also a list but with a lot more components (none of
which are intended for manual examination), apart from the the neighbor
graph which can be found under the <code>graph</code> component in the
same format as the return value of <code>rnnd_knn</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">iris_index</span><span class="op">$</span><span class="va">graph</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; $idx</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    1   18   29    5   28</span></span>
<span><span class="co">#&gt; [2,]    2   13   46   35   10</span></span>
<span><span class="co">#&gt; [3,]    3   48    4    7   13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dist</span></span>
<span><span class="co">#&gt;      [,1]      [,2]      [,3]      [,4]      [,5]</span></span>
<span><span class="co">#&gt; [1,]    0 0.1000000 0.1414212 0.1414212 0.1414213</span></span>
<span><span class="co">#&gt; [2,]    0 0.1414213 0.1414213 0.1414213 0.1732050</span></span>
<span><span class="co">#&gt; [3,]    0 0.1414213 0.2449490 0.2645751 0.2645753</span></span></code></pre></div>
<p>Be aware that for large and high-dimensional data, the returned index
can get <strong>very</strong> large, especially if you set
<code>n_trees</code> to a large value.</p>
</div>
<div class="section level2">
<h2 id="querying-data">Querying Data<a class="anchor" aria-label="anchor" href="#querying-data"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_even</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="va">iris_odd</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span></code></pre></div>
<p>Build the index as before but pass <code>prepare = TRUE</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_even_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnnd_build.html">rnnd_build</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris_even</span>, k <span class="op">=</span> <span class="fl">5</span>, prepare <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_odd_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnnd_query.html">rnnd_query</a></span><span class="op">(</span></span>
<span>  index <span class="op">=</span> <span class="va">iris_even_index</span>,</span>
<span>  query <span class="op">=</span> <span class="va">iris_odd</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">iris_odd_nn</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; $idx</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    9   20   14    4   25</span></span>
<span><span class="co">#&gt; [2,]   24    2   23   15    1</span></span>
<span><span class="co">#&gt; [3,]   19    9    4   14   20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dist</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]      [,4]      [,5]</span></span>
<span><span class="co">#&gt; [1,] 0.1000000 0.1414213 0.1414213 0.1732050 0.2236068</span></span>
<span><span class="co">#&gt; [2,] 0.1414213 0.2449490 0.2645753 0.3000001 0.3000002</span></span>
<span><span class="co">#&gt; [3,] 0.1414213 0.1732050 0.2236066 0.2449488 0.2449488</span></span></code></pre></div>
<p>The other way to do this is to use the standalone
<code>rnnd_prepare</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_even_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnnd_build.html">rnnd_build</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris_even</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">iris_even_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnnd_prepare.html">rnnd_prepare</a></span><span class="op">(</span><span class="va">iris_even_index</span><span class="op">)</span></span>
<span><span class="va">iris_odd_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnnd_query.html">rnnd_query</a></span><span class="op">(</span></span>
<span>  index <span class="op">=</span> <span class="va">iris_even_index</span>,</span>
<span>  query <span class="op">=</span> <span class="va">iris_odd</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If you don’t prepare the index, <code>rnnd_query</code> will do it
for you, but if you want to call <code>rnnd_query</code> multiple times,
it will have to go through the preparation step each time, so it’s more
efficient to prepare the index separately. Another advantage of
preparing the index as soon as possible is that the index will be
reduced in size, as the number of trees used for querying data is
usually substantially smaller than the number used for building the
index.</p>
</div>
<div class="section level2">
<h2 id="parallelism">Parallelism<a class="anchor" aria-label="anchor" href="#parallelism"></a>
</h2>
<p><code>rnndescent</code> is multi-threaded, but by default is
single-threaded. Set <code>n_threads</code> to set the number of threads
you want to use:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_even_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnnd_build.html">rnnd_build</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris_even</span>, k <span class="op">=</span> <span class="fl">5</span>, n_threads <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="available-metrics">Available Metrics<a class="anchor" aria-label="anchor" href="#available-metrics"></a>
</h2>
<p>Several different distances are available in <code>rnndescent</code>
beyond the typically-supported Euclidean and Cosine-based distances in
other nearest neighbor packages. See the <a href="metrics.html">metrics</a> vignette for more details.</p>
</div>
<div class="section level2">
<h2 id="supported-data-types">Supported Data Types<a class="anchor" aria-label="anchor" href="#supported-data-types"></a>
</h2>
<ul>
<li>Dense matrices and data frames.</li>
<li>Sparse matrices, in the <code>dgCMatrix</code>. All the same
distances are supported as for dense matrices.</li>
<li>Additionally, for dense binary data, if you supply it as a
<code>logical</code> matrix, then for certain distances intended for
binary data, specialized functions will be used to speed up the
computation.</li>
</ul>
</div>
<div class="section level2">
<h2 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h2>
<p>There are several options that <code>rnnd_build</code> and
<code>rnnd_query</code> expose that can be modified to change the
behavior of the different stages of the algorithm. See the documentation
for those functions (e.g. <code><a href="../reference/rnnd_build.html">?rnnd_build</a></code>) or the <a href="random-partition-forests.html">Random Partition Forests</a>, <a href="nearest-neighbor-descent.html">Nearest Neighbor Descent</a> and <a href="querying-data.html">Querying Data</a> vignettes for more
details.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-dasgupta2008random" class="csl-entry">
Dasgupta, Sanjoy, and Yoav Freund. 2008. <span>“Random Projection Trees
and Low Dimensional Manifolds.”</span> In <em>Proceedings of the
Fortieth Annual ACM Symposium on Theory of Computing</em>, 537–46.
</div>
<div id="ref-dong2011efficient" class="csl-entry">
Dong, Wei, Charikar Moses, and Kai Li. 2011. <span>“Efficient k-Nearest
Neighbor Graph Construction for Generic Similarity Measures.”</span> In
<em>Proceedings of the 20th International Conference on World Wide
Web</em>, 577–86.
</div>
<div id="ref-harwood2016fanng" class="csl-entry">
Harwood, Ben, and Tom Drummond. 2016. <span>“Fanng: Fast Approximate
Nearest Neighbour Graphs.”</span> In <em>Proceedings of the IEEE
Conference on Computer Vision and Pattern Recognition</em>, 5713–22.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by James Melville.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
