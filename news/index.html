<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Changelog • rnndescent</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Changelog"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rnndescent</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/rnndescent.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/brute-force.html">Brute Force Search</a></li>
    <li><a class="dropdown-item" href="../articles/nearest-neighbor-descent.html">Nearest Neighbor Descent</a></li>
    <li><a class="dropdown-item" href="../articles/random-partition-forests.html">Random Partition Forests</a></li>
    <li><a class="dropdown-item" href="../articles/querying-data.html">Querying Data</a></li>
    <li><a class="dropdown-item" href="../articles/hubness.html">Hubness</a></li>
    <li><a class="dropdown-item" href="../articles/metrics.html">Metrics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jlmelville/rnndescent/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-news">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Changelog</h1>
      <small>Source: <a href="https://github.com/jlmelville/rnndescent/blob/master/NEWS.md" class="external-link"><code>NEWS.md</code></a></small>
    </div>

    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.7" id="rnndescent-017">rnndescent 0.1.7<a class="anchor" aria-label="anchor" href="#rnndescent-017"></a></h2>
<p>This is a patch release to fix some M1 Mac test failures as part of CRAN checks. No changes to non-test code.</p>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.6" id="rnndescent-016">rnndescent 0.1.6<a class="anchor" aria-label="anchor" href="#rnndescent-016"></a></h2><p class="text-muted">CRAN release: 2024-05-14</p>
<ul><li>This is a patch release to fix an issue that occurred with the recent release of a new version of ‘dqrng’ on CRAN. Unfortunately, version 0.1.5 didn’t quite work out. A fix for incorrect behavior for some metrics is also included (see below).</li>
</ul><div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-1-6">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-1-6"></a></h3>
<ul><li>Building an index with the <code>"cosine"</code>, <code>"jaccard"</code> or <code>"hellinger"</code> metrics could give incorrect results if maximally-dissimilar items were in the nearest neighbors. Thank you to <a href="https://github.com/BERENZ" class="external-link">Maciej Beręsewicz</a> for the report (<a href="https://github.com/jlmelville/rnndescent/issues/14" class="external-link uri">https://github.com/jlmelville/rnndescent/issues/14</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.5" id="rnndescent-015">rnndescent 0.1.5<a class="anchor" aria-label="anchor" href="#rnndescent-015"></a></h2><p class="text-muted">CRAN release: 2024-04-18</p>
<ul><li>This is a minor release to change an internal API to support an upcoming release for dqrng. See <a href="https://github.com/daqana/dqrng/issues/80" class="external-link uri">https://github.com/daqana/dqrng/issues/80</a>. Thank you to <a href="https://github.com/rstub" class="external-link">Ralf Stubner</a> for the report and a patch.</li>
</ul></div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.4" id="rnndescent-014">rnndescent 0.1.4<a class="anchor" aria-label="anchor" href="#rnndescent-014"></a></h2><p class="text-muted">CRAN release: 2024-03-18</p>
<div class="section level3">
<h3 id="new-features-0-1-4">New features<a class="anchor" aria-label="anchor" href="#new-features-0-1-4"></a></h3>
<ul><li>New parameter: for <code>nnd_knn</code> and <code>rnnd_build</code>: <code>weight_by_degree</code>. If set to <code>TRUE</code>, then the candidate list in nearest neighbor descent is weighted in favor of low-degree items, which should make for a more diverse local join. There is a minor increase in computation but also a minor increase in accuracy.</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-1-4">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-1-4"></a></h3>
<ul><li>
<code>rnnd_build</code> generated an error when preparing the search graph for some metrics (notably <code>cosine</code> and <code>jaccard</code>).</li>
<li>Fix a factor of 2 error in the TS-SS metric. This does not affect the returned neighbors, just the distances. Thank you to reporter <a href="https://github.com/mhlinder" class="external-link">Henry Linder</a> (<a href="https://github.com/jlmelville/rnndescent/issues/8" class="external-link uri">https://github.com/jlmelville/rnndescent/issues/8</a>).</li>
<li>New parameter for <code>prepare_search_graph</code>: <code>use_alt_metric</code>. This behaves like the existing <code>use_alt_metric</code> parameters in other functions and may speed up the index preparation step in e.g. <code>rnnd_build</code>.</li>
<li>New parameter for <code>rnnd_build</code> and <code>prepare_search_graph</code>: <code>prune_reverse</code>. If set to <code>TRUE</code> the reverse graph will be pruned using the <code>pruning_degree_multiplier</code> parameter before any diversification. This can help prevent an excessive amount of time being spent in the diversification step in the case where an item has a large number of neighbors (in the reverse graph this can be as large as the number of items in the dataset). Pruning of the merged graph still occurs, so this is an additional pruning step. This should have little effect on search results, but for backwards compatibility, the default is <code>FALSE</code>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.3" id="rnndescent-013">rnndescent 0.1.3<a class="anchor" aria-label="anchor" href="#rnndescent-013"></a></h2><p class="text-muted">CRAN release: 2023-12-07</p>
<p>CRAN resubmission to fix lingering UBSAN errors.</p>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.2" id="rnndescent-012">rnndescent 0.1.2<a class="anchor" aria-label="anchor" href="#rnndescent-012"></a></h2>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-1-2">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-1-2"></a></h3>
<ul><li>Some internal Address/Undefined Behavior Sanitizer fixes discovered by CRAN checks on the 0.1.1 submission have been fixed.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.1" id="rnndescent-011">rnndescent 0.1.1<a class="anchor" aria-label="anchor" href="#rnndescent-011"></a></h2><p class="text-muted">CRAN release: 2023-11-27</p>
<p>Initial CRAN submission.</p>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.16" id="rnndescent-0016">rnndescent 0.0.16<a class="anchor" aria-label="anchor" href="#rnndescent-0016"></a></h2>
<div class="section level3">
<h3 id="breaking-changes-0-0-16">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-0-16"></a></h3>
<ul><li>
<code>rnnd_build</code> now always prepares the search graph.</li>
<li>The <code>rnnd_prepare</code> function has been removed. The option to not prepare the search graph during index building only made sense if you were only interested in the k-nearest neighbor graph. Now that <code>rnnd_knn</code> exists for that purpose (see below), the logic of index building has been substantially simplified.</li>
<li>The <code>nn_to_sparse</code> function has been removed.</li>
<li>The <code>merge_knn</code> function has been removed, and <code>merge_knnl</code> has been renamed to <code>merge_knn</code>. If you were running e.g. <code>merge_knn(nn1, nn2)</code>, you must now use <code>merge_knn(list(nn1, nn2))</code>. Also the parameter <code>nn_graphs</code> has been renamed <code>graphs</code>.</li>
</ul></div>
<div class="section level3">
<h3 id="new-features-0-0-16">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-16"></a></h3>
<ul><li>New function: <code>rnnd_knn</code>. Behaves a lot like <code>rnnd_build</code>, but <em>only</em> returns the knn graph with no index built. The index can be very large in size for high dimensional or large datasets, so this function is useful if you only care about the knn graph and won’t ever want to query new data.</li>
<li>New function: <code>neighbor_overlap</code>. Measures the overlap of two knn graphs via their shared indices. A similar function was used extensively in some vignettes so it may have sufficient utility to be useful to others.</li>
<li>New parameter for <code>rnnd_query</code> and <code>graph_knn_query</code>: <code>max_search_fraction</code>. This parameter controls the maximum number of nodes that can be searched during querying. If the number of nodes searched exceeds this fraction of the total number of nodes in the graph, the search will be terminated. This can be used in combination with <code>epsilon</code> to avoid excessive search times.</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-16">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-16"></a></h3>
<ul><li>The sparse <code>spearmanr</code> distance has been fixed.</li>
<li>During tree-building with <code>n_threads = 0</code>, progress/interrupt monitoring was not occurring.</li>
<li>You can provide a user-defined graph to the <code>init</code> parameter of <code>rnnd_query</code>.</li>
<li>
<code>rnnd_query</code>: if <code>verbose = TRUE</code>, a summary of the min, max and average number of distance queries will be logged. This can help tune <code>epsilon</code> and <code>max_search_fraction</code>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.15" id="rnndescent-0015">rnndescent 0.0.15<a class="anchor" aria-label="anchor" href="#rnndescent-0015"></a></h2>
<div class="section level3">
<h3 id="breaking-changes-0-0-15">Breaking Changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-0-15"></a></h3>
<ul><li>Standalone distance functions have been removed. They hadn’t expanded to match all the distances available in the nearest neighbor functions, nor was sparse support added. Doing so would increase the size of this package’s API even further. They may show up in another package.</li>
<li>The <code>local_scale_nn</code> has been removed, for similar reasons to the removal of the standalone distance functions. It remains in the <code>localscale</code> branch of the github repo.</li>
<li>The search graph returned from <code>prepare_search_graph</code> is now transposed. This prevents having to repeatedly transpose inside every call to <code>graph_knn_query</code> if multiple queries are being made. You will need to either regenerate any saved search graphs or transpose them with <code>Matrix::t(search_graph)</code>.</li>
</ul></div>
<div class="section level3">
<h3 id="new-features-0-0-15">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-15"></a></h3>
<ul><li>New functions: <code>rnnd_build</code>, <code>rnnd_query</code> and <code>rnnd_prepare</code>. These functions streamline the process of building a k-nearest neighbor graph, preparing a search graph and querying it.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.14" id="rnndescent-0014">rnndescent 0.0.14<a class="anchor" aria-label="anchor" href="#rnndescent-0014"></a></h2>
<div class="section level3">
<h3 id="breaking-changes-0-0-14">Breaking Changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-0-14"></a></h3>
<ul><li><p>The <code>bhamming</code> metric no longer exists as a specialized metric. Instead, if you pass a <code>logical</code> matrix to <code>data</code>, <code>reference</code> or <code>query</code> parameter (depending on the function) and specify <code>metric = "hamming"</code> you will automatically get the binary-specific version of the hamming metric.</p></li>
<li>
<p>The <code>hamming</code> and <code>bhamming</code> metrics are now normalized with respect to the number of features, to be consistent with the other binary-style metrics (and PyNNDescent). If you need the old distances, multiply the distance matrix by the number of columns, e.g. do something like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brute_force_knn.html">brute_force_knn</a></span><span class="op">(</span><span class="va">X</span>, metric <span class="op">=</span> <span class="st">"hamming"</span><span class="op">)</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">dist</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
</li>
<li><p>The metric <code>l2sqr</code> has been renamed <code>sqeuclidean</code> to be consistent with PyNNDescent.</p></li>
</ul></div>
<div class="section level3">
<h3 id="new-features-0-0-14">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-14"></a></h3>
<ul><li>Metrics? We got ’em! The <code>metric</code> parameter now accepts a much larger number of metrics. See the rdoc for the full list of supported metrics. Currently, most of the metrics from PyNNDescent which don’t require extra parameters are supported. The number of specialized binary metrics has also been expanded.</li>
<li>New parameter for <code>rpf_knn</code> and <code>rpf_build</code>: <code>max_tree_depth</code> this controls the depth of the tree and was set to 100 internally. This default has been doubled to 200 and can now be user-controlled. If <code>verbose = TRUE</code> and the largest leaf in the forest exceeds the <code>leaf_size</code> parameter, a message warning you about this will be logged and indicates that the maximum tree depth has been exceeded. Increasing <code>max_tree_depth</code> may not be the answer: it’s more likely there is something unusual about the distribution of the distances in your dataset and a random initialization might be a better use of your time.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.13" id="rnndescent-0013">rnndescent 0.0.13<a class="anchor" aria-label="anchor" href="#rnndescent-0013"></a></h2>
<div class="section level3">
<h3 id="new-features-0-0-13">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-13"></a></h3>
<ul><li>Sparse data is now supported. Pass a <code>dgCMatrix</code> to the <code>data</code>, <code>reference</code> or <code>query</code> parameters where you would usually use a dense matrix or data frame. <code>cosine</code>, <code>euclidean</code>, <code>manhattan</code>, <code>hamming</code> and <code>correlation</code> are all available, but alternative versions in the dense case, e.g. <code>cosine-preprocess</code> or the binary-specific <code>bhamming</code> for dense data is not.</li>
<li>A new <code>init</code> option for <code>graph_knn_query</code>: you can now pass an RP forest and initialize with that, e.g. from <code>rpf_build</code>, or by setting <code>ret_forest = TRUE</code> on <code>nnd_knn</code> or <code>rpf_knn</code>. You may want to cut down the size of the forest used for initialization with <code>rpf_filter</code> first, though (a single tree may be enough). This will also use the metric data in the forest, so setting <code>metric</code> (or <code>use_alt_metric</code>) in the function itself will be ignored.</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-13">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-13"></a></h3>
<ul><li>If the knn graph you pass to <code>prepare_search_graph</code> or to <code>graph_knn_query</code> contains missing data, this will no longer cause an error (it still might not be the best idea though).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.12" id="rnndescent-0012">rnndescent 0.0.12<a class="anchor" aria-label="anchor" href="#rnndescent-0012"></a></h2>
<div class="section level3">
<h3 id="new-features-0-0-12">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-12"></a></h3>
<ul><li>New function: <code>rpf_knn</code>. Calculates the approximate k-nearest neighbors using a random partition forest.</li>
<li>New function: <code>rpf_build</code>. Builds a random partition forest.</li>
<li>New function: <code>rpf_knn_query</code>. Queries a random partition forest (built with <code>rpf_build</code> to find the approximate nearest neighbors for the query points.</li>
<li>New function: <code>rpf_filter</code>. Retains only the best “scoring” trees in a forest, where each tree is scored based on how well it reproduces a given knn.</li>
<li>New initialization method for <code>nnd_knn</code>: <code>init = "tree"</code>. Uses the RP Forest initialization method.</li>
<li>New parameter for <code>nnd_knn</code>: <code>ret_forest</code>. Returns the search forest used if <code>init = "tree"</code> so it can be used for future searching or filtering.</li>
<li>New parameter for <code>nnd_knn</code>: <code>init_opts</code>. Options that can be passed to the RP forest initialization (same as in <code>rpf_knn</code>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.11" id="rnndescent-0011">rnndescent 0.0.11<a class="anchor" aria-label="anchor" href="#rnndescent-0011"></a></h2>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-11">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-11"></a></h3>
<ul><li>Progess report for <code>nnd_knn</code> with <code>n_threads &gt; 0</code> was reporting double the actual number of iterations. This made the progress bar way too optimistic.</li>
<li>A bug with flagging neighbors in 0.0.10 made the nearest neighbor descent inefficient.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.10" id="rnndescent-0010">rnndescent 0.0.10<a class="anchor" aria-label="anchor" href="#rnndescent-0010"></a></h2>
<div class="section level3">
<h3 id="new-features-0-0-10">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-10"></a></h3>
<ul><li>A change to <code>metric</code>: <code>"cosine"</code> and <code>"correlation"</code> have been renamed <code>"cosine-preprocess"</code> and <code>"correlation-preprocess"</code> respectively. This reflects that they do some preprocessing of the data up front to make subsequent distance calculations faster. I have endeavored to avoid unnecessary allocations or copying in this preprocessing, but there is still a chance of more memory usage.</li>
<li>The <code>cosine</code> and <code>correlation</code> metrics are still available as an option, but now use an implementation that doesn’t do any preprocessing. The preprocessing and non-preprocessing version should give the same numerical results, give or take some minor numerical differences, but when the distance should be zero, the preprocessing versions may give values which are slightly different from zero (e.g. 1e-7).</li>
<li>New functions: <code>correlation_distance</code>, <code>cosine_distance</code>, <code>euclidean_distance</code>, <code>hamming_distance</code>, <code>l2sqr_distance</code>, <code>manhattan_distance</code> for calculating the distance between two vectors, which may be useful for more arbitrary distance calculations than the nearest neighbor routines here, although they won’t be as efficient (they do call the same C++ code, though). The cosine and correlation calculations here use the non-preprocessing implementations.</li>
<li>Generalize <code>hamming</code> metric to a standard definition. The old implementation of <code>hamming</code> metric which worked on binary data only was renamed into <code>bhamming</code>. (contributed by <a href="https://github.com/vspinu" class="external-link">Vitalie Spinu</a>)</li>
<li>New parameter <code>obs</code> has been added to most functions: set <code>obs = "C"</code> and you can pass the input data in column-oriented format.</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-10">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-10"></a></h3>
<ul><li>The <code>random_knn</code> function used to always return each item as its own neighbor, so that only <code>n_nbrs - 1</code> of the returned neighbors were actually selected at random. Even I forgot it did that and it doesn’t make a lot of sense, so now you really do just get back <code>n_nbrs</code> random selections.</li>
<li>If providing pre-calculated neighbors as the <code>init</code> parameter to <code>nnd_knn</code> or <code>graph_knn_query</code>: previously, if <code>k</code> was specified and larger than the number of neighbors included in <code>init</code>, this gave an error. Now, <code>init</code> will be augmented with random neighbors to reach the desired <code>k</code>. This could be useful as a way to “restart” a neighbor search from a better-than-random location if <code>k</code> has been found to have been too small initially. Note that the random selection does not take into account the identities of the already chosen neighbors, so duplicates may be included in the augmented result, which will reduce the effective size of the initialized number of neighbors.</li>
<li>Removed the <code>block_size</code> and <code>grain_size</code> parameters from functions. These were related to the amount of work done per thread, but it’s not obvious to an outside user how to set these.</li>
<li>Most long-running computations should update any progress indicators more frequently (if <code>verbose = TRUE</code>) and respond to user-requested cancellation.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.9" id="rnndescent-009-20-june-2021">rnndescent 0.0.9 (20 June 2021)<a class="anchor" aria-label="anchor" href="#rnndescent-009-20-june-2021"></a></h2>
<div class="section level3">
<h3 id="new-features-0-0-9">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-9"></a></h3>
<ul><li>
<code>nnd_knn_query</code> has been renamed to <code>graph_knn_query</code> and now more closely follows the current pynndescent graph search method (including backtracking search).</li>
<li>New function: <code>prepare_search_graph</code> for preparing a search graph from a neighbor graph for use in <code>graph_knn_query</code>, by using reverse nearest neighbors, occlusion pruning and truncation.</li>
<li>Sparse graphs are supported as input to <code>graph_knn_query</code>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.8" id="rnndescent-008-10-october-2020">rnndescent 0.0.8 (10 October 2020)<a class="anchor" aria-label="anchor" href="#rnndescent-008-10-october-2020"></a></h2>
<p>There was a major rewrite of the internal organization of the C++ to be less R-specific.</p>
<div class="section level3">
<h3 id="minor-license-change-0-0-8">Minor License Change<a class="anchor" aria-label="anchor" href="#minor-license-change-0-0-8"></a></h3>
<p>The license for rnndescent has changed from GPLv3 to GPLv3 or later.</p>
</div>
<div class="section level3">
<h3 id="new-features-0-0-8">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-8"></a></h3>
<ul><li>New metric: <code>"correlation"</code>. This is (1 minus) the Pearson correlation.</li>
<li>New function: <code>k_occur</code> which counts the k-occurrences of each item in the <code>idx</code> matrix, which is the number of times an item appears in the k-nearest neighbor list in the dataset. The distribution of the k-occurrences can be used to diagnose the “hubness” of a dataset. Items with a large k-occurrence (&gt;&gt; k, e.g. 10k), may indicate low accuracy of the approximate nearest neighbor result.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.7" id="rnndescent-007-1-march-2020">rnndescent 0.0.7 (1 March 2020)<a class="anchor" aria-label="anchor" href="#rnndescent-007-1-march-2020"></a></h2>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-7">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-7"></a></h3>
<p>To avoid undefined behavior issues, rnndescent now uses an internal implementation of RcppParallel’s <code>parallelFor</code> loop that works with <code>std::thread</code> and does not load Intel’s TBB library.</p>
</div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.6" id="rnndescent-006-29-november-2019">rnndescent 0.0.6 (29 November 2019)<a class="anchor" aria-label="anchor" href="#rnndescent-006-29-november-2019"></a></h2>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-6">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-6"></a></h3>
<ul><li>For some reason, I thought it would be ok to use the <code>dqrng</code> sample routines from inside a thread, despite it clearly using the R API extensively. It’s not ok and causes lots of crashes. There is now a re-implementation of <code>dqrng</code>’s sample routines using plain <code>std::vector</code>s in <code>src/rnn_sample.h</code>. That file is licensed under the AGPL (<code>rnndescent</code> as a whole remains GPL3).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.5" id="rnndescent-005-23-november-2019">rnndescent 0.0.5 (23 November 2019)<a class="anchor" aria-label="anchor" href="#rnndescent-005-23-november-2019"></a></h2>
<div class="section level3">
<h3 id="new-features-0-0-5">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-5"></a></h3>
<ul><li>New function: <code>merge_knn</code>, to combine two nearest neighbor graphs. Useful for combining the results of multiple runs of <code>nnd_knn</code> or <code>random_knn</code>. Also, <code>merge_knnl</code>, which operates on a list of multiple neighbor graphs, and can provide a speed up over <code>merge_knn</code> if you don’t mind storing multiple graphs in memory at once.</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-5">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-5"></a></h3>
<ul><li>There was a thread-locking issue to do with converting R matrices to the internal heap data structure that affected <code>nnd_knn</code> with <code>n_threads &gt; 1</code> and <code>random_knn</code> with <code>n_threads &gt; 1</code> and <code>order_by_distance = TRUE</code>.</li>
<li>Potential minor speed improvement for <code>nnd_knn</code> with <code>n_threads &gt; 1</code> due to the use of a mutex pool.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.4" id="rnndescent-004-21-november-2019">rnndescent 0.0.4 (21 November 2019)<a class="anchor" aria-label="anchor" href="#rnndescent-004-21-november-2019"></a></h2>
<p>Mainly an internal clean-up to reduce duplication.</p>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-4">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-4"></a></h3>
<ul><li>By default, <code>nnd_knn</code> and <code>nnd_knn_query</code> use the same progress bar as the brute force and random neighbor functions. Bring back the old per-iteration logging that also showed the current distance sum of the knn with the <code>progress = "dist"</code> option.</li>
<li>For <code>random_knn</code> and <code>random_knn_query</code>, when <code>order_by_distance = TRUE</code> and <code>n_threads &gt; 0</code>, the final sorting of the knn graph will be multi-threaded.</li>
<li>Initialization of the nearest neighbor descent data structures are also multi-threaded if <code>n_threads &gt; 0</code>.</li>
<li>Progress bar updating and cancellation should now be more consistent and less likely to cause hanging and crashing across the different methods.</li>
<li>Using Cosine and Hamming distance may take up less memory or run a bit faster.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.3" id="rnndescent-003-15-november-2019">rnndescent 0.0.3 (15 November 2019)<a class="anchor" aria-label="anchor" href="#rnndescent-003-15-november-2019"></a></h2>
<div class="section level3">
<h3 id="new-features-0-0-3">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-3"></a></h3>
<ul><li>There are now “query” versions of the three functions: <code>nnd_knn_query</code> being the most useful, but <code>brute_force_knn_query</code> and <code>random_knn_query</code> are also available. This allows for <code>query</code> data to search <code>reference</code> data, i.e. the returned indices and distances are relative to the <code>reference</code> data, not any other member of <code>query</code>. These methods are also available in multi-threaded mode, and <code>nnd_knn_query</code> has a low and high memory version.</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-3">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-3"></a></h3>
<ul><li>Incremental search in nearest neighbor descent didn’t work correctly, because retained new neighbors were marked as new rather than old. This made the search repeat distance calculations unnecessarily.</li>
<li>Heap initialization ignored existing distances in the input distance matrix.</li>
<li>The <code>l2</code> metric has been renamed to <code>l2sqr</code> to more accurately reflect what it is: the square of the L2 (Euclidean) metric.</li>
<li>New option <code>use_alt_metric</code>. Set to <code>FALSE</code> if you don’t want alternative, faster metrics (which keep the distance ordering of <code>metric</code>) to be used in internal calculations. Currently only applies to <code>metric = "euclidean"</code>, where the squared Euclidean distance is used internally. Only worth setting this to <code>FALSE</code> if you think the alternative is causing numerical issues (which is a bug, so please report it!).</li>
<li>Random and brute force methods will make use of alternative metrics.</li>
<li>New option <code>block_size</code> for parallel methods, which determines the amount of work done in parallel before checking for user interrupt request and updating any progress.</li>
<li>
<code>random_knn</code> now returns its results in sorted order. You can turn this off with <code>order_distances = FALSE</code>, if you don’t need the sorting (e.g. you are using the results as input to something else).</li>
<li>Progress bars for the <code>brute_force</code> and <code>random</code> methods should now be correct.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.2" id="rnndescent-002-7-november-2019">rnndescent 0.0.2 (7 November 2019)<a class="anchor" aria-label="anchor" href="#rnndescent-002-7-november-2019"></a></h2>
<div class="section level3">
<h3 id="new-features-0-0-2">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-2"></a></h3>
<ul><li>Brute force nearest neighbor function has been renamed to <code>brute_force_knn</code>.</li>
<li>Random nearest neighbors has been renamed to <code>random_knn</code>.</li>
<li>Brute force and random nearest neighbors are now interruptible.</li>
<li>Progress bar will be shown if <code>verbose = TRUE</code>.</li>
<li>
<code>fast_rand</code> option has been removed, as it only applied to single-threading, and had a negligible effect.</li>
</ul><p>Also, a number of changes inspired by recent work in <a href="https://github.com/lmcinnes/pynndescent" class="external-link uri">https://github.com/lmcinnes/pynndescent</a>:</p>
<ul><li>The parallel nearest neighbor descent should now be faster.</li>
<li>The <code>rho</code> sampling parameter has been removed. The size of the candidates (general neighbors) list is now controlled entirely by <code>max_candidates</code>.</li>
<li>Default <code>max_candidates</code> has been reduced to 20.</li>
<li>The <code>use_set</code> logical flag has been replaced by <code>low_memory</code>, which has the opposite meaning. It now also works when using multiple threads. While it follows the pynndescent implementation, it’s still experimental, so <code>low_memory = TRUE</code> by default for the moment.</li>
<li>The <code>low_memory = FALSE</code> implementation for <code>n_threads = 0</code> (originally equivalent to <code>use_set = TRUE</code>) is faster.</li>
<li>New parameter <code>block_size</code>, which balances interleaving of queuing updates versus applying them to the current graph.</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-and-minor-improvements-0-0-2">Bug fixes and minor improvements<a class="anchor" aria-label="anchor" href="#bug-fixes-and-minor-improvements-0-0-2"></a></h3>
<ul><li>In the incremental search, the neighbors were marked as having been selected for the new candidate list even if they were later removed due to the finite size of the candidates heap. Now, only those indices that are still retained after candidate building are marked as new.</li>
<li>Improved man pages (examples plus link to nearest neighbor descent reference).</li>
<li>Removed dependency on Boost headers.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.1" id="rnndescent-001-27-october-2019">rnndescent 0.0.1 (27 October 2019)<a class="anchor" aria-label="anchor" href="#rnndescent-001-27-october-2019"></a></h2>
<ul><li>Initial release.</li>
</ul><div class="section level3">
<h3 id="new-features-0-0-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-0-1"></a></h3>
<ul><li>Nearest Neighbor Descent with the following metrics: Euclidean, Cosine, Manhattan, Hamming.</li>
<li>Support for multi-threading with RcppParallel.</li>
<li>Initialization with random neighbors.</li>
<li>Brute force nearest neighbor calculation.</li>
</ul></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by James Melville.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

